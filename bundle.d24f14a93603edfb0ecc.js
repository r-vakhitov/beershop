(()=>{"use strict";const e=document.querySelector(".pagination__forward"),t=document.querySelector(".pagination__back"),n=document.querySelector(".pagination__current");class a{static create(e,t){return fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log(e)}))}static getCatalog(e){return fetch(e).then((e=>{if(200!==e.status)throw new Error(`Something gone wrong ${e.status}`);return e.json()})).catch((e=>{console.log(`Fetch error ${e}`)}))}}const r=document.querySelector(".catalog"),i=document.querySelector(".favourites"),s=document.querySelector(".favourite__clean-btn");let l=[],o=JSON.parse(localStorage.getItem("favourites")||"[]");function c(e){e.forEach((e=>{o.find((t=>t.id===e.id))?e.innerText="Добавлено":e.innerText="В избранное"}))}function u(){localStorage.setItem("favourites",JSON.stringify(o))}function d(e){const t=`\n  <ul class="favourites__list">${o.map((e=>`\n            <li class="favourites__item">\n            <span>${e.name}</span>\n            <button id="${e.id}" class="favourites__remove-btn">x</button>\n            </li>\n            `)).join("")}</ul>`;i.innerHTML=t,l=i.querySelectorAll("button"),l.forEach((t=>{t.addEventListener("click",(t=>{const n=t.target.id;o=o.filter((e=>e.id!==n)),u(),c(e),d(e)}))}))}function m(i,s=null){a.getCatalog("https://beershop-c42a5-default-rtdb.firebaseio.com/catalog.json").then((a=>function(a,r,i){let s=null;if(a.length){let e=(r-1)*i,t=e+i;s=a.slice(e,t)}return function(a,r,i){const s=+r===Math.ceil(a.length/i),l=1==+r;n.innerHTML=`Станица №${r} из ${Math.ceil(a.length/i)}`,l?t.classList.add("disabled-link"):t.classList.remove("disabled-link"),s?e.classList.add("disabled-link"):e.classList.remove("disabled-link")}(a,r,i),s}(s?s(a):a,i,9))).then((e=>{!function(e){const t=`<ul class="catalog__list">${e.map((e=>`\n            <li class="item">\n                <img class="item__image" src=${e.image_url} width=100>\n                <div class="item__description">\n                  <span class="item__name">${e.name}</span>\n                  <div class="item__text-wrapper">\n                    <span>Поставщик:</span> \n                    <span>${e.contributed_by}</span>\n                  </div>\n                  <div class="item__text-wrapper">\n                    <span>Впервые сварено:</span> \n                    <span> ${e.first_brewed}</span>\n                  </div>\n                  <div class="item__text-wrapper">\n                    <span>Горечь IBU:</span> \n                    <span> ${e.ibu?e.ibu:"Неизвестно"}</span>\n                  </div>\n                  <div class="item__text-wrapper">\n                    <span>Алкоголь:</span> \n                    <span> ${e.abv}%</span>\n                  </div>\n                  <button id=${e.id} type="button" class="item__fav-btn">В избранное</button>\n                </div>\n            </li>\n            `)).join("")}</ul>`;r.innerHTML=t,d()}(e);const t=document.querySelectorAll(".item__fav-btn");!function(e){e.forEach((t=>{t.addEventListener("click",(t=>{((e,t)=>{const n={name:e.path[1].querySelector("span").innerText,id:e.target.id};o.find((e=>e.id===n.id))||(o.push(n),u(),d(t))})(t,e),c(e)}))}))}(t),c(t),d(t)}))}function _(e,t){return t.test(e)}s.addEventListener("click",(()=>{o=[],u(),d()}));const f=/7[0-9]{10}/,p=/^[-\w.]+@([A-z0-9][-A-z0-9]+\.)+[A-z]{2,4}$/,b=/\S{6,}/;function v(e,t){const n=JSON.parse(JSON.stringify(t));return n.sort(((t,n)=>parseFloat(t[e])-parseFloat(n[e]))),n}function y(e,t){const n=JSON.parse(JSON.stringify(t));return n.sort(((t,n)=>parseFloat(n[e])-parseFloat(t[e]))),n}const S=document.querySelector(".form"),h=S.querySelectorAll("input"),g=S.querySelectorAll(".form__label"),q=S.querySelector(".form__submit"),L=S.querySelector(".form__number"),E=S.querySelector(".form__email"),k=S.querySelector(".form__pass");function $(){return _(L.value.trim(),f)?g.item(0).classList.add("form__label-valid"):g.item(0).classList.remove("form__label-valid"),_(E.value,p)?g.item(1).classList.add("form__label-valid"):g.item(1).classList.remove("form__label-valid"),_(k.value,b)?g.item(2).classList.add("form__label-valid"):g.item(2).classList.remove("form__label-valid"),_(L.value.trim(),f)&&_(E.value,p)&&_(k.value,b)}const w=document.querySelector(".form-wrapper"),A=w.querySelector(".form"),x=A.querySelectorAll(".form__close"),O=A.querySelector(".form__submit"),T=A.querySelectorAll("input"),j=document.querySelector(".pagination__forward"),J=document.querySelector(".pagination__back"),N=document.querySelector(".sort__button--abv-asc"),F=document.querySelector(".sort__button--abv-desc"),M=document.querySelector(".sort__button--ibu-asc"),z=document.querySelector(".sort__button--ibu-desc"),C=document.querySelector(".feedback");let H=1,I=null;x.forEach((e=>{e.addEventListener("click",(()=>{w.style.display="none"}))})),C.addEventListener("click",(()=>{w.style.display="block"})),A.addEventListener("submit",(function(e){if(e.preventDefault(),$){const e={tel:L.value,email:E.value,password:k.value};q.disabled=!0,a.create(e,"https://beershop-c42a5-default-rtdb.firebaseio.com/users.json").then((()=>{h.forEach((e=>e.value="")),g.forEach((e=>{e.classList.remove("form__label-valid")})),q.disabled=!0}))}})),T.forEach((e=>e.addEventListener("input",(()=>{O.disabled=!$()}))));const B=e=>{H+=e,m(H,I)};j.addEventListener("click",(()=>{B(1)})),J.addEventListener("click",(()=>{B(-1)})),N.addEventListener("click",(()=>{I=v.bind(null,"abv"),m(H,I)})),F.addEventListener("click",(()=>{I=y.bind(null,"abv"),m(H,I)})),M.addEventListener("click",(()=>{I=v.bind(null,"ibu"),m(H,I)})),z.addEventListener("click",(()=>{I=y.bind(null,"ibu"),m(H,I)})),m(H)})();